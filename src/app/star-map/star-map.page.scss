.star-map {
  --ion-background-color: var(--ion-color-step-50);

  .elev {
    border-radius: 16px;
    box-shadow: 0 10px 24px rgba(0,0,0,0.08);
  }

  ion-card-subtitle { opacity: 0.85; }

  .form {
    .metric-label { margin-bottom: 6px; }
    ion-segment {
      border-radius: 12px;
      margin-top: 4px;
    }
  }

  .status {
    margin-top: 8px;
    border-radius: 12px;
    --background: var(--ion-color-light);
    &.muted {
      --background: transparent;
      ion-label { opacity: 0.9; }
    }
  }

  /* Canvas card */
  .canvas-card {
    position: relative;
  }

  .canvas-wrap {
    position: relative;
    width: 100%;
    /* Nice viewport height with safe mobile space */
    height: clamp(320px, 55vh, 720px);
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid rgba(0,0,0,0.06);
    background:
      linear-gradient(transparent 39px, rgba(0,0,0,0.05) 40px),
      linear-gradient(90deg, transparent 39px, rgba(0,0,0,0.05) 40px),
      radial-gradient(1000px 1000px at 0 0, rgba(0,0,0,0.02), transparent);
    background-size: 40px 40px, 40px 40px, auto;
    backdrop-filter: saturate(1.1);
  }

  canvas {
    display: block;
    width: 100%;
    height: 100%;
  }

  .canvas-toolbar {
    position: absolute;
    top: 8px;
    right: 8px;
    z-index: 2;
    display: flex;
    gap: 2px;
    background: color-mix(in srgb, var(--ion-background-color) 80%, transparent);
    border: 1px solid rgba(0,0,0,0.06);
    border-radius: 12px;
    padding: 2px;
    backdrop-filter: blur(6px);
  }

  .legend {
    position: absolute;
    left: 8px;
    bottom: 8px;
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    z-index: 2;
    padding: 2px;
    background: color-mix(in srgb, var(--ion-background-color) 85%, transparent);
    border: 1px solid rgba(0,0,0,0.06);
    border-radius: 12px;

    ion-chip {
      border-radius: 10px;
      ion-icon { margin-right: 6px; }
    }
  }

  .hint { opacity: 0.8; margin-top: 8px; }

  /* Dark mode tweaks */
  @media (prefers-color-scheme: dark) {
    .elev { box-shadow: 0 8px 20px rgba(0,0,0,0.35); }
    .canvas-wrap {
      border-color: rgba(255,255,255,0.08);
      background:
        linear-gradient(transparent 39px, rgba(255,255,255,0.05) 40px),
        linear-gradient(90deg, transparent 39px, rgba(255,255,255,0.05) 40px),
        radial-gradient(1000px 1000px at 0 0, rgba(255,255,255,0.03), transparent);
    }
    .canvas-toolbar,
    .legend {
      border-color: rgba(255,255,255,0.08);
    }
  }
}
