<ion-header translucent="true">
  <ion-toolbar>
    <ion-title>Route Tester</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="route-tester">
  <ion-grid fixed>
    <ion-row class="ion-justify-content-center ion-margin-top">
      <ion-col size="12" size-md="10" size-lg="8">

        <!-- Form Card -->
        <ion-card class="elev">
          <ion-card-header>
            <ion-card-title>Compute Route</ion-card-title>
            <ion-card-subtitle>Test paths between system IDs</ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
            <form (ngSubmit)="run()" class="form">
              <ion-row class="ion-gutter">
                <ion-col size="12" size-md="6">
                  <ion-item fill="outline">
                    <ion-label position="stacked">From ID</ion-label>
                    <ion-input type="number" [(ngModel)]="fromId" name="fromId" required></ion-input>
                  </ion-item>
                </ion-col>

                <ion-col size="12" size-md="6">
                  <ion-item fill="outline">
                    <ion-label position="stacked">To ID</ion-label>
                    <ion-input type="number" [(ngModel)]="toId" name="toId" required></ion-input>
                  </ion-item>
                </ion-col>

                <ion-col size="12" size-md="6">
                  <ion-item fill="outline">
                    <ion-label position="stacked">Ship Jump Max <ion-note>(optional)</ion-note></ion-label>
                    <ion-input type="number" inputmode="decimal" placeholder="e.g. 5.0"
                               [(ngModel)]="shipJumpMax" name="jump"></ion-input>
                  </ion-item>
                </ion-col>

                <ion-col size="12" size-md="6">
                  <ion-item lines="none" class="metric-item">
                    <ion-label>Metric</ion-label>
                  </ion-item>
                  <ion-segment [(ngModel)]="metric" name="metric">
                    <ion-segment-button value="3d">
                      <ion-label>3D</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="2d">
                      <ion-label>2D</ion-label>
                    </ion-segment-button>
                  </ion-segment>
                </ion-col>

                <ion-col size="12" class="ion-text-right ion-margin-top">
                  <ion-button type="submit" color="primary" [disabled]="loading()" expand="block">
                    <ion-spinner slot="start" *ngIf="loading()"></ion-spinner>
                    Compute
                  </ion-button>
                </ion-col>
              </ion-row>
            </form>

            <ion-item lines="none" *ngIf="loading()" class="status muted">
              <ion-spinner slot="start"></ion-spinner>
              <ion-label>Calculatingâ€¦</ion-label>
            </ion-item>

            <ion-item color="danger" lines="none" *ngIf="error()" class="status">
              <ion-icon name="alert-circle" slot="start"></ion-icon>
              <ion-label>Error: {{ error() }}</ion-label>
            </ion-item>
          </ion-card-content>
        </ion-card>

        <!-- Result Card -->
        <ng-container *ngIf="!loading() && result() as r">
          <ion-card class="elev" *ngIf="r.ok; else bad">
            <ion-card-header>
              <ion-card-title>Result</ion-card-title>
            </ion-card-header>

            <ion-card-content>
              <div class="stats">
                <ion-chip outline>
                  <ion-icon name="trail-sign-outline"></ion-icon>
                  <ion-label>Hops: {{ r.hops?.length ?? 0 }}</ion-label>
                </ion-chip>
                <ion-chip outline>
                  <ion-icon name="resize-outline"></ion-icon>
                  <ion-label>Total: {{ r.totalDistance | number:'1.2-4' }}</ion-label>
                </ion-chip>
                <ion-chip outline color="tertiary">
                  <ion-icon name="stats-chart-outline"></ion-icon>
                  <ion-label>Expanded: {{ r.expanded }}</ion-label>
                </ion-chip>
              </div>

              <div class="table-wrap" *ngIf="r.hops?.length">
                <table class="table">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>From (id / name)</th>
                      <th>To (id / name)</th>
                      <th>Distance</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let h of r.hops; let i = index">
                      <td data-col="#">{{ i + 1 }}</td>
                      <td data-col="From">{{ h.from.id }} / {{ h.from.name }}</td>
                      <td data-col="To">{{ h.to.id }} / {{ h.to.name }}</td>
                      <td data-col="Distance">{{ h.distance | number:'1.2-4' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </ion-card-content>
          </ion-card>

          <ng-template #bad>
            <ion-card color="danger" class="elev">
              <ion-card-content>
                <ion-icon name="close-circle" class="ion-margin-end"></ion-icon>
                Request failed: {{ r.error }}
              </ion-card-content>
            </ion-card>
          </ng-template>
        </ng-container>

      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
