<!-- File: src/app/features/ships/ship-detail.page.html -->
<ion-content *ngIf="ship() as s">
  <section class="vds-section">

    <div class="head">
      <vds-badge [series]="s.series">{{ s.code }}</vds-badge>
      <h1 class="vds-h1">{{ s.name }}</h1>
      <span class="vds-chip vds-code">{{ s.class }}</span>
      <span class="vds-chip vds-code" *ngIf="s.line">{{ s.line }}</span>
      <a routerLink="/ships" class="back">Back to Ships</a>
    </div>

    <div class="layout">

      <article class="vds-card prose">
        <bh-model-viewer *ngIf="showViewer"></bh-model-viewer>
        <h2 class="vds-h2">[ DEBRIEF FOR {{s.name}} ]</h2>
        <p>{{ s.summary }}</p>
        <p>{{ s.description }}</p>
      </article>

      <aside class="right">
        
        <!-- Loading State -->
        <div *ngIf="loadingStats()" class="vds-card loading-state">
          <div class="spinner"></div>
          <p>Loading specifications...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="statsError()" class="vds-card error-state">
          <p>⚠️ {{ statsError() }}</p>
          <button (click)="retryLoadStats()" class="btn">Retry</button>
        </div>
        <!-- Stats Loaded - driven from API via signal -->
        <vds-spec-grid 
          *ngIf="!loadingStats() && !statsError()" 
          [specs]="specs()">
        </vds-spec-grid>

        <div class="cta vds-card">
          <a routerLink="/codex" class="btn">View in Codex</a>
          <a routerLink="/media" class="btn">Download Poster</a>
        </div>
      </aside>
    </div>
  </section>
</ion-content>